package com.opensource.vdb;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebFilter;

import org.apache.commons.text.StringEscapeUtils;
import org.apache.commons.lang3.Range;

/**
 * Servlet Filter implementation class InputFilter
 */
@WebFilter("/add_data")
public class InputFilter implements Filter {

    /**
     * Default constructor. 
     */
	String unEscapedString1 = null;
	String unEscapedString2 = null;
	String unEscapedString3 = null;
	String unEscapedString4 = null;
	String unEscapedString5 = null;
	
	String escapedHTML1 = null;
	String escapedHTML2 = null;
	String escapedHTML3 = null;
	String escapedHTML4 = null;
	String escapedHTML5 = null;
	
	
    public InputFilter() {
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see Filter#destroy()
	 */
	public void destroy() {
		// TODO Auto-generated method stub
	}

	/**
	 * @see Filter#doFilter(ServletRequest, ServletResponse, FilterChain)
	 */
	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
		// TODO Auto-generated method stub
		PrintWriter out=response.getWriter(); 
		out.print("In the filter");
		System.out.println("In the filter");
		
		//taking data from UI
		unEscapedString1 = request.getParameter("category");
		unEscapedString2 = request.getParameter("descri");
		unEscapedString3 = request.getParameter("cwe");
		unEscapedString4 = request.getParameter("references");
		unEscapedString5 = request.getParameter("remediation");
		
		//adding validation
        escapedHTML1 = StringEscapeUtils.escapeHtml4(unEscapedString1);
        escapedHTML2 = StringEscapeUtils.escapeHtml4(unEscapedString2);
        escapedHTML3 = StringEscapeUtils.escapeHtml4(unEscapedString3);
        escapedHTML4 = StringEscapeUtils.escapeHtml4(unEscapedString4);
        escapedHTML5 = StringEscapeUtils.escapeHtml4(unEscapedString5);

        request.setAttribute("category", StringEscapeUtils.escapeEcmaScript(escapedHTML1));
        request.setAttribute("descri", StringEscapeUtils.escapeEcmaScript(escapedHTML2));
        request.setAttribute("cwe", StringEscapeUtils.escapeEcmaScript(escapedHTML3));
        request.setAttribute("references", StringEscapeUtils.escapeEcmaScript(escapedHTML4));
        request.setAttribute("remediation", StringEscapeUtils.escapeEcmaScript(escapedHTML5));
        
        System.out.println(StringEscapeUtils.escapeEcmaScript(escapedHTML1)); 
        System.out.println(escapedHTML2); 
        System.out.println(escapedHTML3); 
        System.out.println(escapedHTML4); 
        System.out.println(escapedHTML5);
		
		// pass the request along the filter chain
		chain.doFilter(request, response);
	}

	/**
	 * @see Filter#init(FilterConfig)
	 */
	public void init(FilterConfig fConfig) throws ServletException {
		// TODO Auto-generated method stub
	}

}
