package com.opensource.vdb;

import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Properties;

public class DBConnection {

		public static Connection getConnection(){
			Connection con = null;
			GetSetDB gsd = new GetSetDB();
			
			try (InputStream input = new FileInputStream("../../../config.properties")) {

	            Properties prop = new Properties();

	            // load a properties file
	            prop.load(input);
	            
	            String url = "jdbc:mysql://"+prop.getProperty("db.host")+":"+prop.getProperty("db.port")+"/"+prop.getProperty("db.database");
	            System.out.println(url);
	            String username = prop.getProperty("db.user");
	            String pass = prop.getProperty("db.pass");
	            
				Class.forName(prop.getProperty("db.driver"));
				con = DriverManager.getConnection(url,username,pass);
				System.out.println("DB Connection successfull");
			}
			catch(ClassNotFoundException ce){
				ce.printStackTrace();
			}
			catch(SQLException se ){
			}
			catch (IOException ex) {
		            ex.printStackTrace();
			}
			return con;
		}

		public static int insert(String query){
			Connection con = getConnection();
			int updatedRow = 0;
			try{
			PreparedStatement ps = con.prepareStatement(query);
			
			updatedRow = ps.executeUpdate();
			}
			catch(SQLException se){
				se.printStackTrace();
			}
			return updatedRow;
		}
		
		public static ResultSet retrieve(String query){
			Connection con = getConnection();
			ResultSet rs= null;
			try{
			Statement ps = con.createStatement();
			rs = ps.executeQuery(query);
			}
			catch(SQLException se){
				se.printStackTrace();
			}
			return rs;
		}
		
		
	}
		



